<ul class="breadcrumb">
  <li>
    <i class="icon-home"></i> <%= link_to "Home", root_path %>
    <span class="divider">/</span>
  </li>
  <li>
    <i class="icon-book"></i> <%= link_to "Projects", projects_path %>
    <span class="divider">/</span>
  </li>
  <li>
    <i class="icon-file"></i> “<%= link_to @project.name, project_path(@project) %>”
    <span class="divider">/</span>
  </li>
  <i class="icon-repeat"></i> <li class="active">“<%= @project.iterations.count(:conditions => ['id < ?', @iteration.id]) %>”</li>
</ul>

<div class="row">
  <div class="span8">
    <h2>
      <% if (@project.iterations.count(:conditions => ['id < ?', @iteration.id]) == 0) %>
        “The Planning”
      <% else %>
        <%= (@project.iterations.count(:conditions => ['id < ?', @iteration.id])).ordinalize %>
      <% end %>
    </h2>
    <h6>Project: <%= link_to @project.name, project_path(@project) %></h6>
  </div>
  <div class="span4">
    <div class="btn-toolbar">
      <div class="btn-group">
        <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
          <i class="icon-cog"></i> Iteration actions
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li>
            <%= link_to edit_project_iteration_path(@project, @iteration) do %>
              <i class="icon-pencil"></i> Edit iteration
            <% end %>
          </li>
          <li>
            <%= link_to [@project, @iteration], confirm: 'Are you sure?', method: :delete do %>
              <i class="icon-remove"></i> Delete iteration
            <% end %>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>


<div class="row">

  <div class="span8">
    <div class="well">

      <div class="row">
        <div class="span2">
          <div><strong>Starting date:</strong></div>
          <div><%= @iteration.starting_date.strftime("%A, %d %B %Y") %></div>
        </div>
        <div class="span2">
          <div><strong>Ending date:</strong></div>
          <div><%= @iteration.ending_date.strftime("%A, %d %B %Y") %></div>
        </div>
        <div class="span2">
          <div>
            <strong>Number of days:</strong> <%= (@iteration.ending_date.to_date - @iteration.starting_date.to_date).to_i %>
          </div>
        </div>
      </div>

      <% unless @iteration.notes.empty? %>
        <br />
        <div class="row">
          <div class="span6">
            <p>
              <strong>Notes:</strong>
              <%= @iteration.notes.html_safe %>
            </p>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="span4">
  </div>

</div>

<h3>Stories in this iteration</h3>
<% unless @iteration.stories_in_iterations.empty? %>
  <%= simple_form_for([@project, @iteration]) do |f| %>
    <% @iteration.stories_in_iterations.each.with_index do |stories_in_iteration, index| %>
        <%= f.fields_for :stories_in_iterations, stories_in_iteration do |builder| %>
          <%= render "stories_in_iteration_fields", f: builder, index: index %>
        <% end %>
    <% end %>
    <%= f.button :submit, :class => "btn-primary" %>
  <% end -%>
<% else %>
  <p>No stories. <%= link_to "Add some", edit_project_iteration_path(@project, @iteration) %>.</p>
<% end %>
